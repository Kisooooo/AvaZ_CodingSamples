<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Circle Packing Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div id="chart"></div>

    <script>
        // Load the data from the JSON file
        d3.json("output_data.json").then(function(data) {
            // Set up the dimensions and margin for the chart
            var width = 1000;
            var height = 1000;
            var margin = 600;

            // Create a color scale for the companies
            var color = d3.scaleOrdinal(d3.schemeCategory10);

            // Create a pack layout and set its size
            var pack = d3.pack()
                .size([width - margin, height - margin])
                .padding(5);

            // Create a hierarchy from the data
            var root = d3.hierarchy(data)
                .sum(function(d) { return d.value; })
                .sort(function(a, b) { return b.value - a.value; });

            // Assign colors to the companies
            root.each(function(d) {
                if (d.depth === 2) {
                    d.color = color(d.data.name);
                }
            });

            // Apply the pack layout to the hierarchy
            pack(root);

            // Create the SVG container for the chart
            var svg = d3.select("#chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

                

            // Create circles for each node in the hierarchy
            var nodes = svg.selectAll("circle")
                .data(root.descendants().slice(1))
                .enter()
                .append("circle")
                .attr("fill", function(d) { return d.color; })
                .attr("r", function(d) { return d.r; })
                .attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; })
                .attr("stroke", "white")
                .attr("stroke-width", 1)
                .on("mouseover", function(d) {
                    // Show tooltip on mouseover
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0.9);
                    tooltip.html(d.data.name + "<br/>" + d.data.value)
                        .style("left", (d3.event.pageX + 10) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    // Hide tooltip on mouseout
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });



                // Add tooltips on hover
                svg.selectAll("circle")
                    .on("mouseover", function(d) {
                        // Show tooltip with company name and value
                        tooltip.text(d.data.name + ": " + d.data.value);
                        tooltip.style("visibility", "visible");
                    })
                    .on("mousemove", function() {
                        // Position tooltip based on mouse cursor
                        tooltip.style("top", (d3.event.pageY - 10) + "px")
                            .style("left", (d3.event.pageX + 10) + "px");
                    })
                    .on("mouseout", function() {
                        // Hide tooltip on mouseout
                        tooltip.style("visibility", "hidden");
                    });

                // Implement click interaction
                svg.selectAll("circle")
                    .on("click", function(d) {
                        // Perform actions on click, such as opening a new page or displaying more information
                        console.log("Clicked on:", d.data.name);
                    });


            // Create a tooltip div
            var tooltip = d3.select("body")
                .append("div")
                .style("position", "absolute")
                .style("background-color", "white")
                .style("border", "1px solid black")
                .style("border-radius", "5px")
                .style("padding", "10px")
                .style("opacity", 0);

            // Add labels to the circles

            var top2Companies = root.children.slice(0, 2);
            var threshold = d3.min(top2Companies, function(d) { return d.value; });

            svg.selectAll("text")
                .data(root.descendants().filter(function(d) { return d.depth === 2 && d.value >= threshold || d.depth === 1; }))
                .enter()
                .append("text")
                .attr("text-anchor", "middle")
                .attr("x", function(d) { return d.x; })
                .attr("y", function(d) { return d.y; })
                .text(function(d) { return d.data.name; })
                .style("font-size", "10px")
                .style("font-weight", "bold")
                .style("pointer-events", "none");

        });
    </script>
</body>
</html>
